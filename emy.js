!function(){function init(){if(!emy.ready){emy.changeClass(emy.$("html")[0],"no-js","js"),emy.ready=!0;var e=document.createElement("div").style;prefix=""==e.WebkitTransform?"webkit":""==e.MozTransform?"moz":""==e.msTransform?"ms":""==e.transform?"none":null,"css"==emy.transitionMode&&(emy.transitionMode=prefix?"css":"js"),"webkit"==prefix?(emy.prefixedProperty.transform="webkitTransform",emy.prefixedProperty.transformDuration="webkitTransformDuration",emy.prefixedProperty.transitionEnd="webkitTransitionEnd",emy.prefixedProperty.animationStart="webkitAnimationStart",emy.prefixedProperty.animationDuration="webkitAnimationDuration",emy.prefixedProperty.animationEnd="webkitAnimationEnd"):"moz"==prefix?(emy.prefixedProperty.transform="MozTransform",emy.prefixedProperty.transformDuration="MozTransformDuration",emy.prefixedProperty.transitionEnd="transitionend",emy.prefixedProperty.animationStart="animationstart",emy.prefixedProperty.animationDuration="animationduration",emy.prefixedProperty.animationEnd="animationend"):"ms"==prefix?(emy.prefixedProperty.transform="msTransform",emy.prefixedProperty.transformDuration="msTransformDuration",emy.prefixedProperty.transitionEnd="transitionend",emy.prefixedProperty.animationStart="MSAnimationStart",emy.prefixedProperty.animationDuration="MSAnimationDuration",emy.prefixedProperty.animationEnd="MSAnimationEnd"):"none"==prefix&&(emy.prefixedProperty.transform="msTransform",emy.prefixedProperty.transformDuration="msTransformDuration",emy.prefixedProperty.transitionEnd="transitionend",emy.prefixedProperty.animationStart="MSAnimationStart",emy.prefixedProperty.animationDuration="MSAnimationDuration",emy.prefixedProperty.animationEnd="MSAnimationEnd"),navStackStartIndex=history.length;var t=emy.getSelectedView(),n=location.hash.substr(hashPrefix.length),i=n?emy.$("#"+n):null;if(t)emy.originalView=t,emy.showView(t);else{var r=emy.getAllViews();emy.originalView=r.length>0?r[0]:!1}i&&i!=t&&emy.showView(i),"object"==typeof window.onorientationchange?window.onorientationchange=resizeHandler:window.onresize=resizeHandler,"onhashchange"in window?window.onhashchange=checkLocation:checkTimer=setInterval(checkLocation,300),setTimeout(function(){preloadImages(),checkLocation(),fitHeight(),emy.sendEvent("emy-ready",document)},1)}}function followAnchor(e){e.setAttribute("selected","true");var t=emy.gotoView(e.hash.substr(1),!1);setTimeout(function(){e.removeAttribute("selected")},t?0:500)}function followAjax(e,t){e.setAttribute("selected","progress"),emy.showViewByHref(e.href,null,"GET",t,function(){e.removeAttribute("selected")})}function resizeHandler(){fitHeight()}function checkLocation(){if(location.hash!=currentHash){var e=location.hash.substr(hashPrefix.length);""==e&&originalView&&(e=originalView.id),emy.showViewById(e)}}function showDialog(e){scrollTo(0,1),currentDialog=e,e.setAttribute("selected","true"),"css"==emy.transitionMode?setTimeout(function(){emy.addClass(e,"show")},1):emy.addClass(e,"show"),showForm(e),e.onclick=function(e){e.srcElement&&emy.hasClass(e.srcElement,"dialog")&&cancelDialog(e.srcElement)}}function cancelDialog(e){"css"==emy.transitionMode?(setTimeout(function(){emy.changeClass(e,"show","")},1),e.addEventListener(emy.prefixedProperty.transitionEnd,hideForm,!1)):(emy.changeClass(e,"show",""),hideForm(e))}function showForm(e){e.addEventListener("click",function(){},!0),emy.busy=!1}function hideForm(e){if(void 0==e.srcElement)e.removeAttribute("selected");else{var t=emy.$("#"+e.srcElement.id+" .toolbar")[0];t.style.display="",e.srcElement.removeAttribute("selected"),e.srcElement.removeEventListener(emy.prefixedProperty.transitionEnd,hideForm,!1)}}function updateView(e,t){e.id||(e.id="__"+(new Date).getTime()+"__"),currentHash=hashPrefix+e.id,t?location.assign(currentHash):location.replace(currentHash),navStack.push(e.id);var n=emy.$("#viewTitle");e.getAttribute("data-title")&&(n.innerHTML=e.getAttribute("data-title")),"form"==e.localName.toLowerCase()&&showForm(e);var i=emy.$("#backButton");if(i){var r=emy.$("#"+navStack[navStack.length-2]);r&&!e.getAttribute("data-hidebackbutton")?(i.style.display="block",i.innerHTML=r.getAttribute("data-title")?r.getAttribute("data-title"):"Back"):i.style.display="none"}emy.busy=!1}function canDoSlideAnim(){return"none"!=emy.transitionMode&&null!=emy.prefixedProperty}function slideViews(fromView,toView,backwards){function slideDone(){emy.hasClass(toView,"dialog")||(fromView.removeAttribute("selected"),fromView.removeAttribute("emy-transition"),toView.removeAttribute("emy-transition")),"onhashchange"in window||(checkTimer=setInterval(checkLocation,300)),setTimeout(updateView,0,toView,fromView),fromView.removeEventListener(emy.prefixedProperty.animationEnd,slideDone,!1),fromView.getAttribute("data-onexit")&&eval(fromView.getAttribute("data-onexit")),toView.getAttribute("data-onshow")&&eval(toView.getAttribute("data-onshow")),emy.sendEvent("emy-aftertransition",fromView,{out:!0}),emy.sendEvent("emy-aftertransition",toView,{out:!1}),backwards&&emy.sendEvent("emy-unload",fromView)}scrollTo(0,1),clearInterval(checkTimer),emy.sendEvent("emy-beforetransition",fromView,{out:!0}),emy.sendEvent("emy-beforetransition",toView,{out:!1}),"css"==emy.transitionMode?slideCSS(fromView,toView,backwards,slideDone):"js"==emy.transitionMode?slideJS(fromView,toView,backwards,slideDone):noSlide(fromView,toView,slideDone)}function slideJS(e,t,n,i){function r(){o-=slideStep,e.style.left=(n?100-o:o-100)+"%",t.style.left=(n?-o:o)+"%",0>=o&&(clearInterval(a),o=0,i())}t.style.left="100%",scrollTo(0,1),t.setAttribute("selected","true");var o=100,a=setInterval(r,slideSpeed);r()}function slideCSS(e,t,n,i){function r(){e.setAttribute("emy-transition",a),t.setAttribute("emy-transition",s),t.style.visibility=""}if(t.style.visibility="hidden",n)var o=e.getAttribute("custom-transition")?e.getAttribute("custom-transition"):"slide";else var o=t.getAttribute("custom-transition")?t.getAttribute("custom-transition"):"slide";var a=n?o+"backout":o+"out",s=n?o+"backin":o+"in";t.setAttribute("selected","true"),e.addEventListener(emy.prefixedProperty.animationEnd,i,!1),setTimeout(r,1)}function noSlide(e,t,n){setTimeout(function(){e.removeAttribute("selected"),t.setAttribute("selected","true"),n()},1)}function submitForm(e){emy.addClass(e,"progress"),emy.sendEvent("emy-beforeformsubmit",document.body,{form:e}),emy.showViewByHref(e.getAttribute("action"),encodeForm(e),e.hasAttribute("method")?e.getAttribute("method"):"GET",null,function(){emy.changeClass(e,"progress",""),cancelDialog(e),emy.sendEvent("emy-afterformsubmit",document.body,{form:e})})}function ajaxParam(e){var t=[];for(var n in e){var i=e[n];if(null!=i&&"object"==typeof i&&"number"==typeof i.length)for(var r=0;r<i.length;r++)t[t.length]=encodeURIComponent(n)+"="+encodeURIComponent(i[r]);else t[t.length]=encodeURIComponent(n)+"="+encodeURIComponent(i)}return t.join("&").replace(/%20/g,"+")}function encodeForm(e){function t(e){for(var t=0;t<e.length;++t)if(e[t].name){var i=e[t];if("checkbox"==i.getAttribute("type")&&!i.checked||"radio"==i.getAttribute("type")&&!i.checked||i.disabled)continue;if("submit"==i.getAttribute("type")){if(!i.getAttribute("submitvalue"))continue;i.removeAttribute("submitvalue")}var r=n[i.name];void 0===r?n[i.name]=i.value:r instanceof Array?r.push(i.value):n[i.name]=[r,i.value]}}var n={};return t(e.getElementsByTagName("input")),t(e.getElementsByTagName("textarea")),t(e.getElementsByTagName("select")),t(e.getElementsByTagName("button")),n}function replaceElementWithFrag(e,t){var n=e.parentNode,i=n.parentNode;i.removeChild(n),emy.sendEvent("beforereplace",document.body,{fragment:t});for(var r;t.firstChild;)r=i.appendChild(t.firstChild),emy.sendEvent("afterreplace",document.body,{insertedNode:r});emy.sendEvent("afterreplaceend",document.body,{fragment:t})}function preloadImages(){var e=document.createElement("div");e.id="preloader",document.body.appendChild(e)}function fitHeight(){if(window.scrollTo(0,0),0==screenHeight)var e=screenHeight;else var e=window.innerHeight;setTimeout(function(){var t,n=emy.$(".toolbar")[0].clientHeight,i=emy.$("body")[0].childNodes;if(i)for(var r=1;r<=i.length-1;r++)""==i[r].id||void 0==i[r].id||"object"!=typeof i[r]||emy.hasClass(i[r],"toolbar")||(t=e,window.navigator.standalone===!1?navigator.userAgent.toLowerCase().search("ipad")>-1?t=e:emy.hasClass(i[r],"dialog")?t=e+60:2>screenHeight&&(t=e+60):navigator.userAgent.toLowerCase().search("android")>-1&&0==screenHeight?t=e+50:navigator.userAgent.toLowerCase().search("firefox")>-1&&(t=e-n),i[r].style.minHeight=t+"px");0==screenHeight?(screenHeight=1,fitHeight()):1==screenHeight&&(screenHeight=t),setTimeout(function(){window.scrollTo(0,1)},1)},1)}var slideSpeed=10,slideStep=5,ajaxTimeoutVal=3e4,prefix=null,originalView=null,currentView=null,currentDialog=null,currentWidth=0,currentHeight=0,currentHash=location.hash,hashPrefix="#_",navStackStartIndex=0,navStack=[],checkTimer,screenHeight=0;window.emy={logging:!1,busy:!1,transitionMode:"css",httpHeaders:{"X-Requested-With":"XMLHttpRequest"},prefixedProperty:[],plugin:[],ready:!1,v:function(){return 1.1},init:function(){init()},showView:function(e,t){if(e){if(e==currentView)return void(emy.busy=!1);if(currentDialog&&(currentDialog.removeAttribute("selected"),emy.sendEvent("emy-blur",currentDialog),currentDialog=null),emy.hasClass(e,"dialog"))emy.sendEvent("emy-focus",e),showDialog(e);else{emy.sendEvent("emy-load",e);var n=currentView;emy.sendEvent("emy-blur",currentView),currentView=e,emy.sendEvent("emy-focus",e),n?setTimeout(slideViews,0,n,e,t):updateView(e,n)}}},gotoView:function(e,t){var n,i;if(e instanceof HTMLElement?(n=e,i=n.id):(i=e,n=emy.$("#"+i)),n||emy.log("gotoView: node is null"),emy.busy)return!0;emy.busy=!0;var r=navStack.indexOf(i),o=-1!=r;return o?navStack.splice(r):t&&navStack.pop(),emy.showView(n,o),!1},showViewById:function(e){emy.gotoView(e,!1)},goBack:function(e){if(e){var t=navStack.length-(navStack.indexOf(e)+1);navStack=navStack.slice(0,navStack.length-t),window.history.length>navStackStartIndex?window.history.go(-t):emy.showView(e,!0)}else window.history.length-(navStackStartIndex-1)==1?emy.showView(navStack.pop(),!0):(navStack.pop(),window.history.go(-1));return navStack},showViewByHref:function(e,t,n,i,r){function o(e){var t=document.createElement("div");t.innerHTML=e,i?(replaceElementWithFrag(i,t),emy.busy=!1):emy.insertViews(t),r&&setTimeout(r,1e3,!0)}emy.busy?r():(emy.busy=!0,emy.ajax(e,t,n,o))},ajax:function(e,t,n,i,r){function o(){try{a.abord()}catch(e){}r&&!a.aborted&&r(a),a.aborted=!0}var a=new XMLHttpRequest;n=n?n.toUpperCase():"GET",t&&"GET"==n&&(e=e+"?"+ajaxParam(t)),a.open(n,e,!0),i&&(a.onreadystatechange=function(){emy.log(a),a.aborted||(4==a.readyState&&200==a.status&&a.responseText?(a.aborted=!0,i&&i(a.responseText)):0!=a.status||a.aborted||o())});var s=null;t&&"GET"!=n&&(a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s=emy.param(t));for(var m in emy.httpHeaders)a.setRequestHeader(m,emy.httpHeaders[m]);return a.send(s),a.requestTimer=setTimeout(o,ajaxTimeoutVal),a},insertViews:function(e,t){var n;"string"==typeof e?(n=document.createElement("div"),n.innerHTML=e):"section"==e.nodeName.toLowerCase()&&e.getAttribute("data-title")?(n=document.createElement("div"),n.appendChild(e)):n=e;var i,r=n.childNodes;t=0==t?!1:!0,emy.sendEvent("emy-beforeinsert",document.body,{fragment:n});for(var o=0,a=r.length;a>o;o++){var s=r[o];if(s&&"section"==s.nodeName.toLowerCase()){s.id||(s.id="__"+(new Date).getTime()+"__");var m,d=emy.$("#"+s.id);d?(d.parentNode.replaceChild(s,d),m=emy.$(s.id)):m=document.body.appendChild(s),emy.sendEvent("emy-afterinsert",document.body,{insertedNode:m}),fitHeight(),"true"!=s.getAttribute("selected")&&i||(i=s),--o}}emy.sendEvent("emy-afterinsertend",document.body,{fragment:n}),i&&t&&setTimeout(function(){emy.showView(i)},1)},getSelectedView:function(){for(var e=document.body.firstChild;e;e=e.nextSibling)if(1==e.nodeType&&"true"==e.getAttribute("selected"))return e},getAllViews:function(){var e=document.body.children,t=[];if(e){for(var n=0,i=e.length;i>n;n++)e[n].id&&e[n].getAttribute("data-title")&&t.push(e[n]);return t}return!1},isNativeUrl:function(e){for(var t=[new RegExp("^javascript:"),new RegExp("^mailto:"),new RegExp("^tel:"),new RegExp("^sms:"),new RegExp("^callto:"),new RegExp("^skype:"),new RegExp("^video:"),new RegExp("^music:"),new RegExp("^maps:"),new RegExp("^feed:"),new RegExp("^(http|https)://itunes.apple.com/"),new RegExp("^(http|https)://youtube.com/watch\\?v="),new RegExp("^(http|https)://youtube.com/v/"),new RegExp("^http://youtu.be/"),new RegExp("^(http|https)://maps.google.com/?"),new RegExp("^(http|https)://www.google.com/maps/?"),new RegExp("^(http|https)://facebook.com/"),new RegExp("^(http|https)://twitter.com/")],n=!1,i=0;i<t.length;i++)e.match(t[i])&&(n=!0);return n},hasClass:function(e,t){return e.className.indexOf(t)>-1?!0:!1},addClass:function(e,t){emy.hasClass(e,t)||(e.className+=" "+t)},changeClass:function(e,t,n){emy.hasClass(e,t)&&(e.className=e.className.replace(new RegExp("(\\s|^)"+t+"(\\s|$)")," "+n+" "))},$:function(e){if(document.querySelectorAll){var t=document.querySelectorAll(e);return 0==t.length?null:1==t.length&&"#"+t[0].id==e?t[0]:t}if("#"==e.substr(0,1))return document.getElementById(e.substr(1))?document.getElementById(e.substr(1)):null;if("."==e.substr(0,1))return document.getElementsByClassName(e.substr(1))?document.getElementsByClassName(e.substr(1)):null;if(e.indexOf(".")>-1){for(var n=document.getElementsByTagName(e.split(".")[0]),i=e.split(".")[1],r=0,o=n.length;o>r;r++)if(n[r].className.indexOf(i)>-1)return n[r]}else if(e)return document.getElementsByTagName(e)?document.getElementsByTagName(e):null},log:function(){void 0!=window.console&&1==emy.logging&&console.log.apply(console,arguments)},findParent:function(e,t){for(;e&&(1!=e.nodeType||e.localName.toLowerCase()!=t);)e=e.parentNode;return e},sendEvent:function(e,t,n){if(t){var r=document.createEvent("UIEvent");if(r.initEvent(e,!1,!1),n)for(i in n)r[i]=n[i];t.dispatchEvent(r)}emy.log("event sent: "+e)}},addEventListener("load",init,!1),addEventListener("click",function(e){function t(){n.removeAttribute("selected")}emy.busy||"onhashchange"in window||(checkTimer=setInterval(checkLocation,300));var n=emy.findParent(e.target,"a");if(n){if(n.href&&n.hash&&"#"!=n.hash&&!n.target)followAnchor(n);else if(n==emy.$("#backButton"))n.setAttribute("selected","true"),setTimeout(function(){t()},300),emy.goBack();else if("_replace"==n.target)followAjax(n,n);else{if(emy.isNativeUrl(n.href))return;if("_webapp"==n.target)location.href=n.href;else{if(n.target||!n.getAttribute("href"))return""!=n.href&&n.href?void 0:void 0;followAjax(n,null)}}e.preventDefault()}var i=emy.findParent(e.srcElement,"button");if(i&&"cancel"==i.getAttribute("type")){var r=emy.findParent(e.srcElement,"section");emy.hasClass(r,"dialog")&&cancelDialog(r)}else i&&"submit"!=i.getAttribute("type")&&e.preventDefault()},!0),addEventListener("submit",function(e){var t=e.target;"_self"!=t.target&&(e.preventDefault(),submitForm(t))},!0)}();